{% extends "partials/admin_base.html" %}
{% load static %}
{% block body %}

        <section class="content-main">
            <div class="content-header">
                <div>
                    <h2 class="content-title card-title">Categories </h2>
                    <p>Add, edit or delete a category</p>
                </div>
               
            </div>
            <div class="card">
                <div class="card-body">
                    <div class="col-md-3">
                        <form method="post" action="" enctype="multipart/form-data">
                            {% csrf_token %}
                            <div class="mb-4">
                              <label>Current Images:</label>
                              {% if categories_image %}
                                  <img src="{{ categories_image.url}}" alt="Category Image" style="max-width: 200px; max-height: 200px;">
                              {% else %}
                                  <p>No image available</p>
                              {% endif %}
                            </div>






                            <div class="mb-4">
                              <label for="category_name">Category Name:</label>
                              <input type="text" name="category_name" value="{{ categories_title }}" required>
                          
                            </div>
                            <div class="card-body">
                              <div class="input-upload">
                                            <label for="category_image">New Image:</label>
                                            <input type="file" class="form-control" id="category_image" name="category_image" accept="image/*">
                                            </div>

                                            <div id="cropper-container" style="display:none; margin-top:10px;">
                                            <img id="image-preview" style="max-width:100%; border-radius:6px;" />
                                            <button type="button" class="btn btn-success mt-2" id="crop-button">Crop</button>
                                            </div>

                                            <!-- Hidden field to store cropped image -->
                                            <input type="hidden" name="cropped_image_data" id="cropped_image_data">
                                        </div>
                                     </div>
                                
                                </div>
                                <div class="d-grid">
                                    <button type="submit" class="btn btn-primary">Apply Changes</button>
                                </div>
                        </form>
                   </div>
                       
                    </div> <!-- .row // -->
                </div> <!-- card body .// -->
            </div> <!-- card .// -->
        </section> <!-- content-main end// -->








<!-- ðŸ§  Cropping Script -->
<script>
let cropper;
const fileInput = document.getElementById('category_image');
const imagePreview = document.getElementById('image-preview');
const cropperContainer = document.getElementById('cropper-container');
const cropButton = document.getElementById('crop-button');

fileInput.addEventListener('change', (e) => {
  const file = e.target.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = (event) => {
    imagePreview.src = event.target.result;
    cropperContainer.style.display = 'block';

    if (cropper) cropper.destroy();
    cropper = new Cropper(imagePreview, {
      aspectRatio: 1,
      viewMode: 1,
      autoCropArea: 1,
    });
  };
  reader.readAsDataURL(file);
});

cropButton.addEventListener('click', () => {
  if (!cropper) return;
  const canvas = cropper.getCroppedCanvas({ width: 500, height: 500 });
  canvas.toBlob((blob) => {
    const reader = new FileReader();
    reader.onloadend = () => {
      document.getElementById('cropped_image_data').value = reader.result;
    };
    reader.readAsDataURL(blob);
  });
});
</script>
{% endblock body %}